<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ã‚¯ãƒ©ã‚¹é€£çµ¡</title>
<style>
body { font-family: system-ui, -apple-system, "ãƒ¡ã‚¤ãƒªã‚ª", sans-serif; padding: 20px; max-width: 900px; margin: 0 auto; background:#fafafa; }
header { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
#gallery {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  grid-auto-rows: 200px;
  gap: 10px;
  justify-items: center;
  margin-top: 10px;
}
@media (max-width: 480px) { #gallery { grid-template-columns: repeat(2, 1fr); } }
.card {
  width: 110px; height: 150px; border: 1px solid #ddd; border-radius: 8px;
  padding: 4px; background: white; cursor: pointer; display: flex; flex-direction: column; align-items: center; position: relative;
}
.card img { width: 100%; height: 100px; object-fit: cover; border-radius: 6px; transition: transform 0.3s; }
.card img:hover { transform: scale(1.05); }
.meta { font-size: 12px; color: #555; margin-top: 4px; white-space: pre-line; text-align: center; }
button { cursor: pointer; padding: 6px 10px; border-radius: 6px; border: 1px solid #bbb; background: #f7f7f7; }
.upload-row { display: flex; gap: 6px; align-items: center; margin-top: 4px; }
.upload-row button { height: 32px; }
#status { font-size: 13px; color: #333; margin-left:8px; max-width:200px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;}
#overlay {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 1000;
}
#overlay img { max-width: 90%; max-height: 90%; border-radius: 8px; cursor: pointer; }
.auth { margin-top: 18px; padding: 12px; border: 1px solid #eee; border-radius: 8px; background: #fff; }
.auth-header { display: flex; align-items: center; gap: 8px; }
.auth-row { display: flex; gap: 10px; margin-top: 8px; }
.auth-row input { padding: 6px 8px; border-radius: 6px; border: 1px solid #ddd; }

/* ---- ãŠã¿ãã˜çµæœã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« ---- */
.omikuji-result { 
  margin-top:8px; padding:10px; background:#fff7e6;
  border-radius:8px; border-left:4px solid #ff9500;
  font-size:14px; text-align:center; display:none;
}
.schedule-display { 
  margin-top:10px; padding:10px; background:#f0f0f0; 
  border-left:4px solid #4facfe; border-radius:6px; display:none; 
}
.schedule-date { font-weight:600; color:#4facfe; margin-bottom:4px; }
.schedule-content { font-size:14px; color:#333; }

.date-buttons { margin-top:10px; display:flex; flex-wrap:wrap; gap:6px; }

/* ================================
   âœ¨ è¯ã‚„ã‹ãªãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«
   ================================ */
/* --- è¯ã‚„ã‹ãªãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆè‰²ã‚’å°‘ã—æ¿ƒãï¼‰ --- */
.fancy-btn {
  padding: 10px 16px;
  border: none;
  border-radius: 10px;
  font-weight: 600;
  font-size: 15px;
  cursor: pointer;
  color: white;
  transition: transform 0.2s, box-shadow 0.2s;
}

/* æ—¥ä»˜ãƒœã‚¿ãƒ³ï¼ˆé’ â†’ æ¿ƒãï¼‰ */
.fancy-blue {
  background: linear-gradient(135deg, #5ed4ff 0%, #3e7bff 100%);
  box-shadow: 0 4px 10px rgba(62, 123, 255, 0.45);
}

.fancy-blue:hover {
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0 6px 14px rgba(62, 123, 255, 0.65);
}

.fancy-blue:active {
  transform: scale(0.97);
}

/* ãŠã¿ãã˜ãƒœã‚¿ãƒ³ï¼ˆé»„é‡‘ â†’ æ¿ƒãï¼‰ */
.fancy-gold {
  background: linear-gradient(135deg, #f5c242 0%, #f48c3e 100%);
  box-shadow: 0 4px 10px rgba(244, 140, 62, 0.45);
}

.fancy-gold:hover {
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0 6px 14px rgba(244, 140, 62, 0.65);
}

.fancy-gold:active {
  transform: scale(0.97);
}

</style>
</head>

<body>

<header>
  <h1>11æœˆ18æ—¥ï¼ˆç«ï¼‰</h1>
  <div id="status" style="margin-left:auto"></div>
</header>

<!-- --- ãŠã¿ãã˜ --- -->
<div class="date-buttons">
  <button class="omikuji-button fancy-btn fancy-gold" onclick="drawOmikuji()">ğŸ¯ ãŠã¿ãã˜ 1æ—¥2å›</button>
</div>
<div id="omikujiResult" class="omikuji-result"></div>

<!-- --- ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« --- -->
<div class="date-buttons">
  <button class="date-button fancy-btn fancy-blue" onclick="showSchedule('tomorrow')">11/18ï¼ˆç«ï¼‰</button>
  <button class="date-button fancy-btn fancy-blue" onclick="showSchedule('following')">11/19ï¼ˆæ°´ï¼‰</button>
  <button class="date-button fancy-btn fancy-blue" onclick="showSchedule('test3')">11/20ï¼ˆæœ¨ï¼‰</button>
  <button class="date-button fancy-btn fancy-blue" onclick="showSchedule('test4')">11/21ï¼ˆé‡‘ï¼‰</button>
 <button class="date-button fancy-btn fancy-blue" onclick="showSchedule('test5')">è©¦é¨“ä¸Šã®æ³¨æ„</button>
</div>

<div id="scheduleDisplay" class="schedule-display">
  <div id="scheduleDate" class="schedule-date"></div>
  <div id="scheduleContent" class="schedule-content"></div>
</div>


<h1></h1>
  
<!-- Webãƒšãƒ¼ã‚¸ -->
<div id="drawArea">
  <iframe src="https://incict-design.github.io/hikariplay/" allowfullscreen style="width:100%;height:300px;border:none;border-radius:6px;"></iframe>
</div>

<!-- ã‚®ãƒ£ãƒ©ãƒªãƒ¼ -->
<section>
  <h2>ç”»å»ŠSHION</h2>
  <div id="gallery"></div>
  <div class="upload-row">
    <input id="fileInput" type="file" accept="image/*" style="display:none;">
    <button id="selectBtn">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</button>
    <button id="uploadBtn">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
    <span id="status"></span>
  </div>
</section>

<!-- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ -->
<section class="auth">
  <div class="auth-header">
    <h3 style="margin:0;">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</h3>
    <div id="authStatus">æœªãƒ­ã‚°ã‚¤ãƒ³</div>
    <button id="loginBtn">ãƒ­ã‚°ã‚¤ãƒ³</button>
    <button id="logoutBtn" style="display:none;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
  </div>
  <div class="auth-row">
    <input id="email" type="email" placeholder="icj21/ich24....@s.icc.ac.jp">
    <input id="password" type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼šæƒ…å ±æ•™å®¤">
  </div>
</section>

<div id="overlay"><img id="overlayImg" src=""></div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

<script>
// ===== ãŠã¿ãã˜ãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« =====
const scheduleData = {
  'tomorrow': { date: '11/18ï¼ˆç«ï¼‰', content: '<div>1é™ï¼šè«–ç†å›½èª</div><div>2é™ï¼šæ–‡ï¼šç”Ÿç‰©åŸºç¤ / ç†ï¼šåŒ–å­¦</div>' },
  'following': { date: '11/19ï¼ˆæ°´ï¼‰', content: '<div>1é™ï¼šå…¬å…±</div><div>2é™ï¼šè«–ç†ãƒ»è¡¨ç¾â…¡</div><div>3é™ï¼šï¼”çµ„ã®ã¿ï¼šåœ°ç†æ¢ç©¶</div>' },
  'test3': { date: '11/20ï¼ˆæœ¨ï¼‰', content: '<div>1é™ï¼šå¤å…¸æ¢ç©¶</div><div>2é™ï¼šè‹±èªCâ…¡</div>' },
  'test4': { date: '11/21ï¼ˆé‡‘ï¼‰', content: '<div>1é™ï¼šæ–‡ï¼šä¸–ãƒ»æ—¥ / ç†ï¼šç‰©ãƒ»ç”Ÿ</div><div>2é™ï¼šæ•°å­¦</div>' },
 'test5': { date: 'è©¦é¨“ä¸Šã®æ³¨æ„', content: '<div>ã€è©¦é¨“å ´ã®æ³¨æ„ã€‘</div><div>â‘ ä¸æ­£è¡Œç‚ºã®å³ç¦</div><div>â‘¡ä¸‹æ•·ã®ä½¿ç”¨ç¦æ­¢</div><div>â‘¢è†æ›ä½¿ç”¨ç¦æ­¢</div><div>â‘£æœºä¸Šã«ç½®ãã®ã¯ã€ã‚·ãƒ£ãƒ¼ãƒ—ãƒšãƒ³ã‚·ãƒ«ãƒ»é‰›ç­†ã¨æ¶ˆã—ã‚´ãƒ ã®ã¿ï¼ˆãƒšãƒ³ã‚±ãƒ¼ã‚¹ã¯ç½®ã‹ãªã„ï¼‰ã€‚</div><div>â‘¤æœºã®ä¸­ã«ã¯ç‰©ã‚’å…¥ã‚Œã¦ç½®ã‹ãªã„ï¼ˆè–æ›¸ãƒ»è®ƒç¾æ­Œç­‰ã‚‚å…¥ã‚Œã¦ç½®ã‹ãªã„ï¼‰ã€‚</div><div>â‘¥è©¦é¨“é–‹å§‹5åˆ†å‰ã«ã¯ç€å¸­ã—ã€ç›£ç£ã®å…ˆç”Ÿã‚’é™ã‹ã«å¾…ã¤ã€‚</div><div>â‘¦è©¦é¨“ã¯è½ã¡ç€ã„ãŸæ…‹åº¦ã§å—é¨“ã—ã€èª¤è§£ã‚’æ‹›ãã“ã¨ã®ãªã„ã‚ˆã†ã«ã™ã‚‹ã€‚</div><div>â‘§æœºä¸Šã®è½æ›¸ãã¯æ¶ˆã—ã¦ãŠãã“ã¨ã€‚</div><div>â‘¨æºå¸¯é›»è©±(ã‚¹ãƒãƒ¼ãƒˆã‚¦ã‚©ãƒƒãƒç­‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ©Ÿèƒ½ä»˜ãé›»å­æ©Ÿå™¨ã‚’å«ã‚€)ã¯æœºã®ä¸Šã‚„ä¸­ã«ç½®ã„ãŸã‚Šã€ãƒã‚±ãƒƒãƒˆã«å…¥ã‚ŒãŸã‚Šã›ãšã€å¿…ãšé›»æºã‚’åˆ‡ã£ã¦ãƒãƒƒã‚°ã®ä¸­ã«å…¥ã‚Œã¦ãŠãã€‚</div><div>â‘©ã‚«ãƒãƒ³ã¯ãƒ•ã‚¡ã‚¹ãƒŠãƒ¼ã‚’é–‰ã‚ã¦æ¤…å­ã®ä¸‹ã«ç½®ãã€ã‚«ãƒãƒ³ã®ä¸­ãŒè¦‹ãˆãªã„ã‚ˆã†ã«ã™ã‚‹ã€‚</div><div>â‘ªè¤‡æ•°ç§‘ç›®ãŒåŒä¸€æ™‚é–“ã«ã‚ã‚‹å ´åˆã¯ã€ç§‘ç›®ã”ã¨ã«åº§å¸­ã‚’ç§»å‹•ã™ã‚‹ã€‚</div>' }
};

const omikujiResults = [
  {name:'å¤§ç‹‚',text:'éš•çŸ³æ³¨æ„'},
  {name:'å‡¶',text:'æ°´é‰„ç ²ã§æ’ƒãŸã‚Œã‚‹'},
  {name:'å‰',text:'è„³ç­‹å¤§çˆ†ç™ºï¼'},
  {name:'å°å‰',text:'è„³ã¿ãçµ¶å¯¾é›¶åº¦'},
  {name:'ä¸­å‰',text:'å¸¸åŒ—ãƒ•ã‚¡ãƒ¼ãƒ ã§æ„›ã®ã•ã•ã‚„ã'},
  {name:'å¤§å‰',text:'è©è°·ã¨ç¨ã‚ã£ã“'}
];

function getTodayKey(){ const t=new Date(); return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate(); }
function getDrawCount(){ const k=getTodayKey(); const d=JSON.parse(localStorage.getItem("omikujiCount"))||{}; return d[k]||0; }
function incrementDrawCount(){ const k=getTodayKey(); const d=JSON.parse(localStorage.getItem("omikujiCount"))||{}; d[k]=(d[k]||0)+1; localStorage.setItem("omikujiCount",JSON.stringify(d)); }
function getSecondResult(){ return JSON.parse(localStorage.getItem(getTodayKey()+"-secondResult")); }
function setSecondResult(r){ localStorage.setItem(getTodayKey()+"-secondResult",JSON.stringify(r)); }

function drawOmikuji(){
  const count=getDrawCount();
  const box=document.getElementById("omikujiResult");
  box.style.display="block";
  if(count===0||count===1){
    const r=Math.floor(Math.random()*omikujiResults.length);
    const res=omikujiResults[r];
    if(count===1) setSecondResult(res);
    incrementDrawCount();
    box.innerHTML=`ä»Šæ—¥ã®é‹å‹¢ï¼š<strong>${res.name}</strong><br>${res.text}`;
  }else{
    const saved=getSecondResult();
    box.innerHTML=saved?`ä»Šæ—¥ã®é‹å‹¢ï¼š<strong>${saved.name}</strong><br>${saved.text}`:"ï¼ˆ2å›ç›®ã®çµæœãŒã‚ã‚Šã¾ã›ã‚“ï¼‰";
  }
}

function showSchedule(k){
  document.getElementById("scheduleDate").textContent=scheduleData[k].date;
  document.getElementById("scheduleContent").innerHTML=scheduleData[k].content;
  document.getElementById("scheduleDisplay").style.display="block";
}

// ===== Firebase ç”»åƒå…±æœ‰ =====
const firebaseConfig = {
  apiKey: "AIzaSyCzDqI2YaOLoU4muurvvxBs4fOOSkH8Yew",
  authDomain: "image-share-89916.firebaseapp.com",
  projectId: "image-share-89916",
  storageBucket: "image-share-89916.firebasestorage.app",
  messagingSenderId: "859639070035",
  appId: "1:859639070035:web:aab7543659c3d1a877f5a6"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth(), db=firebase.firestore(), storage=firebase.storage();

const emailInput=document.getElementById("email"),
passwordInput=document.getElementById("password"),
loginBtn=document.getElementById("loginBtn"),
logoutBtn=document.getElementById("logoutBtn"),
authStatus=document.getElementById("authStatus"),
fileInput=document.getElementById("fileInput"),
uploadBtn=document.getElementById("uploadBtn"),
status=document.getElementById("status"),
gallery=document.getElementById("gallery"),
overlay=document.getElementById("overlay"),
overlayImg=document.getElementById("overlayImg"),
selectBtn=document.getElementById("selectBtn");

let selectedFile=null;

// èªè¨¼çŠ¶æ…‹å¤‰æ›´
auth.onAuthStateChanged(user=>{
  if(user){
    authStatus.textContent=`ãƒ­ã‚°ã‚¤ãƒ³ä¸­: ${user.displayName||user.email}`;
    loginBtn.style.display="none";
    logoutBtn.style.display="inline-block";
  }else{
    authStatus.textContent="æœªãƒ­ã‚°ã‚¤ãƒ³";
    loginBtn.style.display="inline-block";
    logoutBtn.style.display="none";
  }
});

// ãƒ­ã‚°ã‚¤ãƒ³
loginBtn.addEventListener("click",async()=>{
  const email=emailInput.value.trim();
  const pass=passwordInput.value;
  if(!email||!pass){ alert("ãƒ¡ãƒ¼ãƒ«ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return;}
  try{
    const user = await auth.signInWithEmailAndPassword(email,pass);
    if(!user.user.emailVerified){
      alert("ãƒ¡ãƒ¼ãƒ«èªè¨¼ãŒå®Œäº†ã—ã¦ã„ã¾ã›ã‚“");
      await auth.signOut();
      return;
    }
  }catch(e){ alert(e.message);}
});

// ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
logoutBtn.addEventListener("click",()=>auth.signOut());

// ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
selectBtn.addEventListener('click',()=>fileInput.click());
fileInput.addEventListener('change',()=>{
  selectedFile=fileInput.files[0]||null;
  status.textContent=selectedFile?selectedFile.name:'';
});

// ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
uploadBtn.addEventListener("click",async()=>{
  const user=auth.currentUser;
  if(!user||!user.emailVerified){status.textContent="ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™"; return;}
  if(!selectedFile){status.textContent="ç”»åƒã‚’é¸æŠã—ã¦ãã ã•ã„"; return;}
  uploadBtn.disabled=true; status.textContent="ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...";
  try{
    const ref=storage.ref(`test-images/${user.uid}`);
    await ref.put(selectedFile);
    const url=await ref.getDownloadURL();
    await db.collection("test-images").doc(user.uid).set({
      username:user.displayName||user.email,
      url,
      updatedAt:new Date()
    });
    status.textContent="ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†ï¼";
    selectedFile=null; fileInput.value="";
  }catch(e){ status.textContent="ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—"; }
  finally{ uploadBtn.disabled=false; }
});

// ã‚®ãƒ£ãƒ©ãƒªãƒ¼è¡¨ç¤º
db.collection("test-images").onSnapshot(snapshot=>{
  gallery.innerHTML="";
  snapshot.forEach(doc=>{
    const data=doc.data();
    const div=document.createElement("div"); div.className="card";
    const img=document.createElement("img"); img.src=data.url;
    div.appendChild(img);
    const meta=document.createElement("div"); meta.className="meta";
    meta.textContent=`${data.username}\n${new Date(data.updatedAt.seconds*1000).toLocaleString()}`;
    div.appendChild(meta);
    img.onclick=()=>{ overlayImg.src=data.url; overlay.style.display="flex"; }
    gallery.appendChild(div);
  });
});
overlay.onclick=()=>{ overlay.style.display="none"; overlayImg.src=""; };
</script>
</body>
</html>
